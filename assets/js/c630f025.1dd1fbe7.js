"use strict";(self.webpackChunkcunicu=self.webpackChunkcunicu||[]).push([[9470],{41117:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>t,default:()=>d,frontMatter:()=>l,metadata:()=>c,toc:()=>m});var a=n(85893),i=n(11151);const l={},t="Session Signaling",c={id:"dev/signaling",title:"Session Signaling",description:"Lets assume two peers $Pa$ & $Pb$ are seeking to establish a ICE session.",source:"@site/docs/dev/signaling.md",sourceDirName:"dev",slug:"/dev/signaling",permalink:"/docs/dev/signaling",draft:!1,unlisted:!1,editUrl:"https://github.com/cunicu/cunicu/edit/main/docs/dev/signaling.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Proxying",permalink:"/docs/dev/proxying"},next:{title:"Project Structure",permalink:"/docs/dev/structure"}},r={},m=[{value:"Session Description",id:"session-description",level:2},{value:"Backends",id:"backends",level:2},{value:"Available backends",id:"available-backends",level:3},{value:"Semantics",id:"semantics",level:3},{value:"Interface",id:"interface",level:3}];function h(e){const s={a:"a",annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",math:"math",mermaid:"mermaid",mi:"mi",mo:"mo",mrow:"mrow",msub:"msub",p:"p",pre:"pre",semantics:"semantics",span:"span",ul:"ul",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h1,{id:"session-signaling",children:"Session Signaling"}),"\n",(0,a.jsxs)(s.p,{children:["Lets assume two peers ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"P"}),(0,a.jsx)(s.mi,{children:"a"})]})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"P_a"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1514em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"a"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})})]})," & ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"P"}),(0,a.jsx)(s.mi,{children:"b"})]})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"P_b"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"b"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})})]})," are seeking to establish a ICE session."]}),"\n",(0,a.jsxs)(s.p,{children:["The smaller public key (PK) of the two peers takes the role of the controlling agent.\nIn this example PA has the role of the controlling agent as: ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"P"}),(0,a.jsx)(s.mi,{children:"K"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"P"}),(0,a.jsx)(s.mi,{children:"a"})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsx)(s.mo,{children:"<"}),(0,a.jsx)(s.mi,{children:"P"}),(0,a.jsx)(s.mi,{children:"K"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"P"}),(0,a.jsx)(s.mi,{children:"b"})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"PK(P_a) < PK(P_b)"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1514em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"a"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"<"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"b"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mclose",children:")"})]})]})]}),"."]}),"\n",(0,a.jsx)(s.mermaid,{value:"sequenceDiagram\n    autonumber\n\n    actor Pa as Peer A\n    actor Pb as Peer B\n    participant b as Backend\n\n    Pa ->> b: SessionDescription(Pa -> Pb)\n    b ->> Pb: SessionDescription(Pa -> Pb)\n\n    Pb ->> b: SessionDescription(Pb -> Pa)\n    b ->> Pa: SessionDescription(Pb -> Pa)"}),"\n",(0,a.jsx)(s.mermaid,{value:"stateDiagram-v2 \n    [*] --\x3e Unknown\n    \n    note right of Unknown\n        No agent exists\n    end note\n\n    Unknown --\x3e Idle: 1. Create new agent<br>2. Send local credentials\n\n    Idle --\x3e New: On remote credentials<br>1. Start gathering local candidates\n    Idle --\x3e Idle: Repeatedly send local credentials with back-off\n\n    New --\x3e Connecting: On remote candidate<br>1. Connect\n    Connecting --\x3e Checking\n    Checking --\x3e Connected\n    Checking --\x3e Failed\n    Completed --\x3e Disconnected\n    Connected --\x3e Disconnected\n    Connected --\x3e Completed\n    Completed --\x3e Closed\n    Disconnected --\x3e Closed\n    Closed --\x3e Idle: 1. Create new agent<br>2. Send local credentials\n    Failed --\x3e Closed"}),"\n",(0,a.jsx)(s.h2,{id:"session-description",children:"Session Description"}),"\n",(0,a.jsxs)(s.p,{children:["Session descriptions are exchanged by one or more the signaling backends via signaling ",(0,a.jsx)(s.em,{children:"envelopes"})," which contain signaling ",(0,a.jsx)(s.em,{children:"messages"}),".\nThe ",(0,a.jsx)(s.em,{children:"envelopes"})," are containers which encrypt the carried ",(0,a.jsx)(s.em,{children:"message"})," via asymmetric cryptography using the public key of the recipient."]}),"\n",(0,a.jsxs)(s.p,{children:["Both the ",(0,a.jsx)(s.em,{children:"envelope"})," and the ",(0,a.jsx)(s.em,{children:"message"})," are serialized using Protobuf."]}),"\n",(0,a.jsxs)(s.p,{children:["Checkout the ",(0,a.jsx)(s.a,{href:"https://github.com/cunicu/cunicu/blob/main/proto/signaling/signaling.proto",children:(0,a.jsx)(s.code,{children:"pkg/pb/signaling.proto"})})," for details."]}),"\n",(0,a.jsx)(s.h2,{id:"backends",children:"Backends"}),"\n",(0,a.jsx)(s.p,{children:"cun\u012bcu can support multiple backends for signaling session information such as session IDs, ICE candidates, public keys and STUN credentials."}),"\n",(0,a.jsx)(s.h3,{id:"available-backends",children:"Available backends"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"gRPC"}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["Checkout the ",(0,a.jsx)(s.a,{href:"https://github.com/cunicu/cunicu/blob/main/pkg/signaling/backend.go",children:(0,a.jsx)(s.code,{children:"Backend"})})," interface for implementing your own backend."]}),"\n",(0,a.jsx)(s.h3,{id:"semantics",children:"Semantics"}),"\n",(0,a.jsx)(s.p,{children:"A backend must:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Must facilitate a reliable delivery ",(0,a.jsx)(s.em,{children:"envelopes"})," between peers using their public keys as addresses."]}),"\n",(0,a.jsxs)(s.li,{children:["Must support delivery of ",(0,a.jsx)(s.em,{children:"envelopes"})," to a group of recipients (e.g. multicast)."]}),"\n",(0,a.jsxs)(s.li,{children:["May deliver the ",(0,a.jsx)(s.em,{children:"envelopes"})," out-of-order."]}),"\n",(0,a.jsxs)(s.li,{children:["May discard ",(0,a.jsx)(s.em,{children:"envelopes"})," if the recipient is not yet known or reachable."]}),"\n",(0,a.jsxs)(s.li,{children:["Shall be stateless. It shall not buffer or record any ",(0,a.jsx)(s.em,{children:"envelopes"}),"."]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"interface",children:"Interface"}),"\n",(0,a.jsxs)(s.p,{children:["All signaling backends implement the rather simple ",(0,a.jsxs)(s.a,{href:"https://github.com/cunicu/cunicu/blob/main/pkg/signaling/backend.go",children:[(0,a.jsx)(s.code,{children:"signaling.Backend"})," interface"]}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-go",children:"type Message = pb.SignalingMessage\n\ntype MessageHandler interface {\n\tOnSignalingMessage(*crypto.PublicKeyPair, *Message)\n}\n\ntype Backend interface {\n\tio.Closer\n\n\t// Publish a signaling message to a specific peer\n\tPublish(ctx context.Context, kp *crypto.KeyPair, msg *Message) error\n\n\t// Subscribe to messages send by a specific peer\n\tSubscribe(ctx context.Context, kp *crypto.KeyPair, h MessageHandler) (bool, error)\n\n\t// Unsubscribe from messages send by a specific peer\n\tUnsubscribe(ctx context.Context, kp *crypto.KeyPair, h MessageHandler) (bool, error)\n\n\t// Returns the backends type identifier\n\tType() signalingproto.BackendType\n}\n"})})]})}function d(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},11151:(e,s,n)=>{n.d(s,{Z:()=>c,a:()=>t});var a=n(67294);const i={},l=a.createContext(i);function t(e){const s=a.useContext(l);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(l.Provider,{value:s},e.children)}}}]);