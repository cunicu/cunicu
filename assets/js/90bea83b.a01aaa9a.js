"use strict";(self.webpackChunkcunicu=self.webpackChunkcunicu||[]).push([[5362],{54534:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>l});var o=i(85893),c=i(11151);const t={sidebar_position:1},a="Configuration",s={id:"config/config",title:"Configuration",description:"This page describes the ways of configuring the cun\u012bcu daemon (cunicu daemon).",source:"@site/docs/config/config.md",sourceDirName:"config",slug:"/config/",permalink:"/docs/config/",draft:!1,unlisted:!1,editUrl:"https://github.com/cunicu/cunicu/edit/main/docs/config/config.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"wg showconf",permalink:"/docs/usage/man/wg/showconf"},next:{title:"Simple Example",permalink:"/docs/config/example-simple"}},r={},l=[{value:"Command Line Flags",id:"command-line-flags",level:2},{value:"Configuration File",id:"configuration-file",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"At Runtime",id:"at-runtime",level:2},{value:"DNS Auto-configuration",id:"dns-auto-configuration",level:2},{value:"Remote Configuration Files",id:"remote-configuration-files",level:2},{value:"Auto-reload",id:"auto-reload",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["This page describes the ways of configuring the cun\u012bcu daemon (",(0,o.jsx)(n.code,{children:"cunicu daemon"}),")."]}),"\n",(0,o.jsx)(n.h2,{id:"command-line-flags",children:"Command Line Flags"}),"\n",(0,o.jsxs)(n.p,{children:["Basic options of ",(0,o.jsx)(n.code,{children:"cunicu daemon"})," can be configured by passing command line arguments.\nA full overview is available in its ",(0,o.jsx)(n.a,{href:"/docs/usage/man/daemon",children:"manpage"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"configuration-file",children:"Configuration File"}),"\n",(0,o.jsx)(n.p,{children:"For more advanced setups, a configuration file can be used for a persistent configuration:"}),"\n",(0,o.jsxs)(n.p,{children:["Please have a look at the ",(0,o.jsx)(n.a,{href:"/docs/config/example-advanced",children:"example configuration file"})," for a full reference of all available settings."]}),"\n",(0,o.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,o.jsx)(n.p,{children:"All the settings from the configuration file can also be passed via environment variables by following the following rules:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Convert the setting name to uppercase"}),"\n",(0,o.jsxs)(n.li,{children:["Prefixing the setting name with ",(0,o.jsx)(n.code,{children:"CUNICU_"})]}),"\n",(0,o.jsx)(n.li,{children:"Nested settings are separated by underscores"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Example:"})," The setting ",(0,o.jsx)(n.code,{children:"ice.max_binding_requests"})," can be set by the environment variable ",(0,o.jsx)(n.code,{children:"CUNICU_ICE_MAX_BINDING_REQUESTS"})]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Setting lists such as ",(0,o.jsx)(n.code,{children:"ice.urls"})," or ",(0,o.jsx)(n.code,{children:"backends"})," can currently not be set via environment variables."]})}),"\n",(0,o.jsx)(n.h2,{id:"at-runtime",children:"At Runtime"}),"\n",(0,o.jsx)(n.p,{children:"cun\u012bcu's configuration can also be updated at runtime, alleviating daemon restarts and interruption of connectivity."}),"\n",(0,o.jsxs)(n.p,{children:["Please have a look at the ",(0,o.jsx)(n.a,{href:"/docs/usage/man/config",children:(0,o.jsx)(n.code,{children:"cunicu config"})})," commands."]}),"\n",(0,o.jsx)(n.p,{children:"Currently, not all settings are runtime tunable."}),"\n",(0,o.jsxs)(n.p,{children:["Changed settings via the ",(0,o.jsx)(n.code,{children:"cunicu config set"})," command are persisted in a runtime configuration file at ",(0,o.jsx)(n.code,{children:"/var/lib/cunicu/runtime.yaml"}),".\nSo runtime changes will also be taken into account for subsequent starts of the daemon."]}),"\n",(0,o.jsx)(n.h2,{id:"dns-auto-configuration",children:"DNS Auto-configuration"}),"\n",(0,o.jsx)(n.p,{children:"cun\u012bcu als supports retrieving parts of the configuration via DNS lookups.\nThis is useful for corporate environments in which a fleet of cun\u012bcu daemon need to be configured centrally."}),"\n",(0,o.jsxs)(n.p,{children:["In this case ",(0,o.jsx)(n.code,{children:"cunicu daemon"})," is started one or more ",(0,o.jsx)(n.code,{children:"--domain example.com"})," parameters to look for the following DNS records to obtain its configuration."]}),"\n",(0,o.jsxs)(n.p,{children:["STUN and TURN servers used for ICE are retrieved by SVR lookups and other cun\u012bcu settings are retrieved via ",(0,o.jsx)(n.code,{children:"SRV"})," and ",(0,o.jsx)(n.code,{children:"TXT"})," lookups:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:'_stun._udp.example.com.  3600 IN SRV 10 0 3478 stun.example.com.\n_stuns._tcp.example.com. 3600 IN SRV 10 0 3478 stun.example.com.\n_turn._udp.example.com.  3600 IN SRV 10 0 3478 turn.example.com.\n_turn._tcp.example.com.  3600 IN SRV 10 0 3478 turn.example.com.\n_turns._tcp.example.com. 3600 IN SRV 10 0 5349 turn.example.com.\n\nexample.com.             3600 IN TXT "cunicu-config=https://example.com/cunicu.yaml"\nexample.com.             3600 IN TXT "cunicu-backend=grpc://signal.example.com:443"\nexample.com.             3600 IN TXT "cunicu-community=my-community-password"\nexample.com.             3600 IN TXT "cunicu-ice-username=user1"\nexample.com.             3600 IN TXT "cunicu-ice-password=pass1"\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"cunicu-backend"})," and ",(0,o.jsx)(n.code,{children:"cunicu-config"})," TXT records can be provided multiple times. Others not."]})}),"\n",(0,o.jsx)(n.h2,{id:"remote-configuration-files",children:"Remote Configuration Files"}),"\n",(0,o.jsxs)(n.p,{children:["When ",(0,o.jsx)(n.code,{children:"cunicu daemon"})," can be started with ",(0,o.jsx)(n.code,{children:"--config"})," options pointing to HTTPS URIs:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"cunicu daemon --config http://example.com/cunicu.yaml\n"})}),"\n",(0,o.jsx)(n.p,{children:"cun\u012bcu will download all configuration files in the order they are specified on the command line and merge them subsequently."}),"\n",(0,o.jsx)(n.p,{children:"This feature can be combined with the DNS auto-configuration method by providing a TXT record pointing to the configuration file:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:'example.com. 3600 IN TXT "cunicu-config=https://example.com/cunicu.yaml"\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Remote configuration files must be fetched via HTTPS if they are not hosted locally and required a trusted server certificate."})}),"\n",(0,o.jsx)(n.h2,{id:"auto-reload",children:"Auto-reload"}),"\n",(0,o.jsx)(n.p,{children:"cun\u012bcu can watch local and remote files as well as the DNS configuration for changes and automatically reloads its configuration from them whenever a change has been detected."}),"\n",(0,o.jsxs)(n.p,{children:["Pass the ",(0,o.jsx)(n.code,{children:"--watch-config"})," or ",(0,o.jsx)(n.code,{children:"-w"})," command line options to ",(0,o.jsx)(n.code,{children:"cunicu daemon"})," to enable this feature."]}),"\n",(0,o.jsxs)(n.p,{children:["For local files the change is detected by ",(0,o.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man7/inotify.7.html",children:"inotify(7)"}),".\nFor remote sources, cun\u012bcu periodically checks the ",(0,o.jsx)(n.code,{children:"Last-Modified"})," and ",(0,o.jsx)(n.code,{children:"Etag"})," headers in case of HTTP files or the DNS zone's ",(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/SOA_record#Structure",children:"SOA serial number"})," to detect changes without request the full remote source."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Configuration file distributed via ",(0,o.jsx)(n.code,{children:"conicu-config"})," DNS TXT record are not yet monitored for changes."]})})]})}function u(e={}){const{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>s,a:()=>a});var o=i(67294);const c={},t=o.createContext(c);function a(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);