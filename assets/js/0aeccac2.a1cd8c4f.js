"use strict";(self.webpackChunkcunicu=self.webpackChunkcunicu||[]).push([[414],{86608:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>d});var r=i(85893),s=i(11151);const t={sidebar_position:20},l="Design",c={id:"design",title:"Design",description:"Architecture",source:"@site/docs/design.md",sourceDirName:".",slug:"/design",permalink:"/docs/design",draft:!1,unlisted:!1,editUrl:"https://github.com/cunicu/cunicu/edit/main/docs/design.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"JSON Schema",permalink:"/docs/config/schema"},next:{title:"Development",permalink:"/docs/dev/"}},a={},d=[{value:"Architecture",id:"architecture",level:2},{value:"Objectives",id:"objectives",level:2},{value:"Related RFCs",id:"related-rfcs",level:2}];function o(e){const n={a:"a",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"design",children:"Design"}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(72507).Z+"",width:"901",height:"629"})}),"\n",(0,r.jsx)(n.h2,{id:"objectives",children:"Objectives"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Encrypt all signaling messages"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Plug-able signaling backends:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"gRPC"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Support ",(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8838",children:"Trickle ICE"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Support ",(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8445#section-2.4",children:"ICE restart"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Support ",(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc6544",children:"ICE-TCP"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Encrypt exchanged ICE offers with WireGuard keys"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Seamless switch between ICE candidates and relays"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Zero configuration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Alleviate users of exchanging endpoint IPs & ports"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Enables direct communication of WireGuard peers behind NAT / UDP-blocking firewalls"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Single-binary, zero dependency installation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Bundled ICE agent & ",(0,r.jsx)(n.a,{href:"https://git.zx2c4.com/wireguard-go",children:"WireGuard user-space daemon"})]}),"\n",(0,r.jsx)(n.li,{children:"Portability"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Support for user and kernel-space WireGuard implementations"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Zero performance impact"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Kernel-side filtering / redirection of WireGuard traffic"}),"\n",(0,r.jsx)(n.li,{children:"Fallback to user-space proxying only if no Kernel features are available"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Minimized attack surface"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Drop privileges after initial configuration"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Compatible with existing WireGuard configuration utilities like:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/max-moser/network-manager-wireguard",children:"NetworkManager"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.freedesktop.org/software/systemd/man/systemd.netdev.html#%5BWireGuard%5D%20Section%20Options",children:"systemd-networkd"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://manpages.debian.org/unstable/wireguard-tools/wg-quick.8.en.html",children:"wg-quick"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kilo.squat.ai",children:"Kilo"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://seashell.github.io/drago/",children:"drago"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Monitoring for new WireGuard interfaces and peers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Inotify for new UAPI sockets in /var/run/wireguard"}),"\n",(0,r.jsx)(n.li,{children:"Netlink subscription for link updates (patch is pending)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-rfcs",children:"Related RFCs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc6544",children:"RFC6544"})," TCP Candidates with Interactive Connectivity Establishment (ICE)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8838",children:"RFC8838"})," Trickle ICE: Incremental Provisioning of Candidates for the Interactive Connectivity Establishment (ICE) Protocol"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8445",children:"RFC8445"})," Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8863",children:"RFC8863"})," Interactive Connectivity Establishment Patiently Awaiting Connectivity (ICE PAC)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8839",children:"RFC8839"})," Session Description Protocol (SDP) Offer/Answer Procedures for Interactive Connectivity Establishment (ICE)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc6062",children:"RFC6062"})," Traversal Using Relays around NAT (TURN) Extensions for TCP Allocations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8656",children:"RFC8656"})," Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8489",children:"RFC8489"})," Session Traversal Utilities for NAT (STUN)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc8866",children:"RFC8866"})," SDP: Session Description Protocol"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc3264",children:"RFC3264"})," An Offer/Answer Model with the Session Description Protocol (SDP)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc7064",children:"RFC7064"})," URI Scheme for the Session Traversal Utilities for NAT (STUN) Protocol"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc7065",children:"RFC7065"})," Traversal Using Relays around NAT (TURN) Uniform Resource Identifiers"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},72507:(e,n,i)=>{i.d(n,{Z:()=>r});const r=i.p+"assets/images/architecture-698f935e44bbe4e44537cc165a669ff3.svg"},11151:(e,n,i)=>{i.d(n,{Z:()=>c,a:()=>l});var r=i(67294);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);